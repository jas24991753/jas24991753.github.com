<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>CocosCreator Test slot-roller | Harry</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Harry</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/about/index.html" class="sidebar-nav-item">About</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>CocosCreator Test slot-roller</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2017-03-27</div><div class="post-categories"><a class="post-category-link" href="/categories/cocos/">cocos</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/cocos/">cocos</a>/<a class="post-tag-link" href="/tags/slot/">slot</a></div></div></div><article><div class="container post"><p>簡易的滾輪設計主要分為三個部份，開始滾動前_readyStartSpin，滾動中update，準備停止_readyStopSpin</p>
<h2 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h2><p>我的練習:<a href="https://github.com/jas24991753/Cocos_Test_Slot" target="_blank" rel="external">Cocos_Test_Slot</a></p>
<h3 id="開始滾動前"><a href="#開始滾動前" class="headerlink" title="開始滾動前"></a>開始滾動前</h3><p>為了讓滾輪的視覺效果看起來像是用力甩出去的效果，所以我們在滾動之前，我們必須先做一個上拉的動作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">//設定為私有的，不讓外部使用</div><div class="line">_readyStartSpin: <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">      // this._scroller為該滾輪節點，取得該滾輪以下所有的<span class="string">'Symbol'</span>節點</div><div class="line">      var symbols = this._scroller.getComponentsInChildren(Symbol);</div><div class="line">      //將該節點的Symbol進行上拉的動作</div><div class="line">      symbols.forEach(<span class="keyword">function</span> (symbol, index, array) &#123;</div><div class="line">          //需位移的數量</div><div class="line">          var shakeStep = Math.ceil(this.symbolHeight * 0.2 * this.rollerScrollRate);</div><div class="line">          //宣告一序列動作進行Y軸位移</div><div class="line">          var action = cc.sequence(</div><div class="line">              //0.1秒內向Y位移shakeStep數量</div><div class="line">              cc.moveBy(0.1, 0, shakeStep),</div><div class="line">              cc.callFunc(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">                  //位移完將symbol轉為模糊圖</div><div class="line">                  symbol.isBlur = <span class="literal">true</span>;</div><div class="line">                  //將Y軸向上取整數對齊</div><div class="line">                  symbol.node.y = Math.ceil(symbol.node.y);</div><div class="line">                  //當最後一個symbol位移好後，開始SPIN</div><div class="line">                  <span class="keyword">if</span> (index == array.length - 1) &#123;</div><div class="line">                      this._isScrolling = <span class="literal">true</span>;</div><div class="line">                  &#125;</div><div class="line">              &#125;, this)</div><div class="line">          );</div><div class="line">          //symbol開始序列動作</div><div class="line">          symbol.node.runAction(action);</div><div class="line">      &#125;, this);</div><div class="line">  &#125;,</div></pre></td></tr></table></figure>
<h3 id="開始滾動，不斷更新"><a href="#開始滾動，不斷更新" class="headerlink" title="開始滾動，不斷更新"></a>開始滾動，不斷更新</h3><p>滾輪開始後會不斷的位移，三輪symbol需要有四格，當最下面那格超過底線後會移到最上面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">//程式不斷的更新</div><div class="line">update: <span class="keyword">function</span> (dt) &#123;</div><div class="line">      //當滾輪處於滾動狀態</div><div class="line">      <span class="keyword">if</span> (this._isScrolling) &#123;</div><div class="line">          //設定位移數量</div><div class="line">          var step = Math.ceil(this.symbolHeight * 0.15 * this.rollerScrollRate);</div><div class="line">          // 取得該滾輪以下所有的<span class="string">'Symbol'</span>節點</div><div class="line">          var symbols = this._scroller.getComponentsInChildren(Symbol);</div><div class="line">          //每個symbol進行位移</div><div class="line">          symbols.forEach(<span class="keyword">function</span> (symbol, index, array) &#123;</div><div class="line">              //位移後的Y軸座標</div><div class="line">              var nextPosition = symbol.node.y - step;</div><div class="line">              //當該Symbol的Y座標小於底線時</div><div class="line">              <span class="keyword">if</span> (nextPosition &lt; this._rollerBottomBound) &#123;</div><div class="line">                  //當處於正在滾動中或滾輪的結果還未給予時，將symbol置換成隨機圖示，並加到最前面，</div><div class="line">                  //如果突然停止，也需滿足當前結果欄數                  </div><div class="line">                  <span class="keyword">if</span> (this._doScrollling || this._rollerSymbolResult.length &lt; this.rollerRows) &#123;</div><div class="line">                      symbol.randomSymbol();</div><div class="line">                      this._rollerSymbolResult.unshift(symbol.symbolIndex);                        </div><div class="line">                  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (this._customRollerResult.length &gt; 0) &#123;   //取得外部滾輪結果並加到滾輪結果最上方</div><div class="line">                      symbol.symbolIndex = this._customRollerResult.pop();</div><div class="line">                      this._rollerSymbolResult.unshift(symbol.symbolIndex);</div><div class="line">                  &#125; <span class="keyword">else</span> &#123;   //當滿足滾輪結果滿足滾輪列數的長度，並且所有結果都填入後，停止滾動</div><div class="line">                      this._isScrolling = <span class="literal">false</span>;</div><div class="line">                  &#125;</div><div class="line">                  //位移小於底線時，位置要移到最上方 </div><div class="line">                  nextPosition = this._rollerTopBound - (this._rollerBottomBound - nextPosition);</div><div class="line">              &#125;</div><div class="line">              //symbol位移</div><div class="line">              symbol.node.y = nextPosition;</div><div class="line">          &#125;, this);</div><div class="line">          //停止更新滾動，並取最後三個結果，並準備停止</div><div class="line">          <span class="keyword">if</span> (this._isScrolling == <span class="literal">false</span>) &#123;</div><div class="line">              this._rollerSymbolResult = this._rollerSymbolResult.slice(0, this.rollerRows);</div><div class="line">              this._readyStopSpin();</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line">  &#125;,</div></pre></td></tr></table></figure>
<h3 id="滾輪準備停止"><a href="#滾輪準備停止" class="headerlink" title="滾輪準備停止"></a>滾輪準備停止</h3><p>按下停止後，當前滾輪的位置會有誤差，校正用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">//設定為私有的，不讓外部使用</div><div class="line">_readyStopSpin: <span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">      // this._scroller為該滾輪節點，取得該滾輪以下所有的<span class="string">'Symbol'</span>節點</div><div class="line">      var symbols = this._scroller.getComponentsInChildren(Symbol);</div><div class="line">      //該symbol向上進行位置校正</div><div class="line">      symbols.forEach(<span class="keyword">function</span> (symbol, index, array) &#123;</div><div class="line">          //取得底線與該symbol節點距離</div><div class="line">          var remain = this._rollerBottomBound - symbol.node.y;</div><div class="line">          //校正該到的位置</div><div class="line">          var adjustment = symbol.symbolHeight - Math.abs(Math.ceil(remain % symbol.symbolHeight));</div><div class="line">          //序列化動作</div><div class="line">          var action = cc.sequence(</div><div class="line">              cc.moveBy(0.05, 0, adjustment),</div><div class="line">              cc.callFunc(<span class="function"><span class="title">function</span></span> () &#123;</div><div class="line">                  //將模糊圖關閉</div><div class="line">                  symbol.isBlur = <span class="literal">false</span>;</div><div class="line">                  //避免位移後的誤差</div><div class="line">                  symbol.node.y = Math.ceil(symbol.node.y);</div><div class="line">                  //當為最後一格symbol時，滾動停止</div><div class="line">                  <span class="keyword">if</span> (index == array.length - 1) &#123;</div><div class="line">                      cc.log(<span class="string">'Final Result:'</span>, this._rollerSymbolResult)</div><div class="line">                      this._doScrollling = <span class="literal">false</span>;</div><div class="line">                      </div><div class="line">                  &#125;</div><div class="line">              &#125;, this)</div><div class="line">          );</div><div class="line">          //symbol開始序列動作</div><div class="line">          symbol.node.runAction(action);</div><div class="line">      &#125;, this);</div><div class="line">  &#125;,</div></pre></td></tr></table></figure></div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:jas24991753@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/jas24991753" target="_blank"><i class="fa fa-github"></i></a></div><div class="footer">© 2020 <a href="/" rel="nofollow">Harry</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>